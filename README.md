# 网页内容爬虫工具

这是一个从Excel文件中批量爬取网页内容的工具，可以自动下载文本、图片和视频，并分别保存到不同的文件夹中。

## 功能特点

- 从Excel文件中读取文章标题和网址
- 自动下载并保存文章文本内容（.txt格式），文本前自动添加标题和网址
- 智能提取文章正文部分，过滤掉页面上的无关内容
- 文本文件末尾会自动添加下载图片的列表信息
- 文本文件末尾会自动添加下载视频的列表信息（如果有视频）
- 自动下载并保存文章中的图片（原始格式，如.jpg、.png等），智能过滤小尺寸图片（如图标或广告）
- 使用HTML中的显示尺寸而非图片实际尺寸来过滤图片
- 只提取文章正文中的图片，避免下载导航栏、页脚等区域的无关图片
- 自动下载并保存文章中的视频（原始格式，如.mp4等）或记录嵌入式视频的链接
- 只提取文章正文中的视频，避免下载页面其他区域的视频
- 灵活的接口设计，只需更改Excel文件名即可处理不同的表格
- 完整的日志记录，方便排查问题

## 安装依赖

在使用前，需要安装以下Python依赖包：

```
pip install pandas openpyxl requests beautifulsoup4 pillow
```

## 使用方法

1. 准备Excel文件，文件中应包含文章标题和网址两列（列名可以是"标题"、"网址"或其他常见命名）
2. 运行脚本：

   ```
   python run_crawler.py [Excel文件名]
   ```

3. 如果不提供Excel文件名参数，程序会自动搜索当前目录下的Excel文件并提示选择

## 输出结果

- 文本内容将保存在 `texts` 文件夹中
  - 文本文件开始部分包含标题和网址信息
  - 文本内容仅包含文章正文部分，过滤了导航栏、页脚等无关内容
  - 文件末尾包含从该文章下载的图片列表
  - 文件末尾包含从该文章下载的视频列表（如果有视频）
- 图片将保存在 `images` 文件夹中
  - 只保存文章正文中的图片
  - 自动过滤HTML显示尺寸小于规定值的图片
  - 自动过滤常见的图标、广告和装饰图片
- 视频将保存在 `videos` 文件夹中
  - 直接下载视频文件（如mp4格式）
  - 对于嵌入式视频（如YouTube、Vimeo等），保存视频链接到文本文件
- 程序运行日志将保存在 `crawler.log` 文件中

## Excel文件格式要求

Excel文件中应至少包含以下两列：
- 标题列：可以是"标题"、"文章标题"、"title"、"Title"或"字段1_文本_文本"
- 网址列：可以是"网址"、"链接"、"url"、"URL"、"link"、"Link"或"字段1_链接_链接"

程序会自动识别这些常见的列名。

## 正文识别规则

为了只提取文章的主要内容，程序会尝试使用以下方法识别文章正文：
- 优先查找常见的文章容器标签，如article、.content、#main-content等
- 如果找不到明确的容器，分析页面中包含最多文本的div元素
- 自动过滤脚本、样式、导航、页脚等无关元素
- 保留段落结构，重构易读的文本格式

## 图片筛选规则

为了避免下载大量与正文无关的图片（如网站图标、广告等），爬虫会自动筛选图片：
- 只下载文章正文容器中的图片
- 优先使用HTML中指定的显示尺寸（width和height属性或style中的宽高）来判断
- 如果HTML中未指定显示尺寸，则使用图片的实际尺寸
- 宽度小于400像素或高度小于300像素的图片会被自动跳过
- 自动过滤URL中包含"icon"、"logo"、"banner"、"ad"等关键词的图片
- 这些参数可以在crawler.py文件中的WebCrawler类初始化方法中调整

## 视频处理规则

爬虫会根据不同类型的视频采取不同的处理方式：
- 对于直接嵌入的视频文件（如mp4、webm等），会下载并保存到本地
- 对于嵌入式播放器（如YouTube、Vimeo等），会保存视频链接到文本文件
- 只处理文章正文容器中的视频，忽略页面其他部分

## 注意事项

1. 爬取速度会受到网络状况和目标网站响应速度的影响
2. 程序内置了随机延迟，以避免请求过快被目标网站封禁
3. 某些网站可能有反爬虫措施，可能无法成功爬取全部内容
4. 视频内容通常较大，爬取过程可能较慢 